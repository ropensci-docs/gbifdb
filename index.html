<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A high performance interface to the Global Biodiversity
  Information Facility, GBIF.  In contrast to rgbif, which can
  access small subsets of GBIF data through web-based queries to
  a central server, gbifdb provides enhanced performance for R users
  performing large-scale analyses on servers and cloud computing
  providers, providing full support for arbitrary SQL or dplyr
  operations on the complete GBIF data tables (now over 1 billion
  records, and over a terabyte in size). gbifdb accesses a copy
  of the GBIF data in parquet format, which is already readily
  available in commercial computing clouds such as the Amazon Open
  Data portal and the Microsoft Planetary Computer, or can be 
  accessed directly without downloading, or downloaded
  to any server with suitable bandwidth and storage space.
  The high-performance techniques for local and remote access 
  are described in &lt;https://duckdb.org/why_duckdb&gt;
  and &lt;https://arrow.apache.org/docs/r/articles/fs.html&gt; respectively.">
<title>High Performance Interface to GBIF • gbifdb</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="High Performance Interface to GBIF">
<meta property="og:description" content="A high performance interface to the Global Biodiversity
  Information Facility, GBIF.  In contrast to rgbif, which can
  access small subsets of GBIF data through web-based queries to
  a central server, gbifdb provides enhanced performance for R users
  performing large-scale analyses on servers and cloud computing
  providers, providing full support for arbitrary SQL or dplyr
  operations on the complete GBIF data tables (now over 1 billion
  records, and over a terabyte in size). gbifdb accesses a copy
  of the GBIF data in parquet format, which is already readily
  available in commercial computing clouds such as the Amazon Open
  Data portal and the Microsoft Planetary Computer, or can be 
  accessed directly without downloading, or downloaded
  to any server with suitable bandwidth and storage space.
  The high-performance techniques for local and remote access 
  are described in &lt;https://duckdb.org/why_duckdb&gt;
  and &lt;https://arrow.apache.org/docs/r/articles/fs.html&gt; respectively.">
<meta property="og:image" content="https://docs.ropensci.org/gbifdb/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="index.html">gbifdb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/intro.html">Intro to gbifdb</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/gbifdb/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="gbifdb">gbifdb<a class="anchor" aria-label="anchor" href="#gbifdb"></a>
</h1>
</div>
<!-- badges: start -->
<p>The goal of <code>gbifdb</code> is to provide a relational database interface to a <code>parquet</code> based serializations of <code>gbif</code>’s AWS snapshots of its public data <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;all CC0 and CC-BY licensed data in GBIF that have coordinates which passed automated quality checks, [see GBIF docs]&lt;a href="https://github.com/gbif/occurrence/blob/master/aws-public-data.md" class="external-link uri"&gt;https://github.com/gbif/occurrence/blob/master/aws-public-data.md&lt;/a&gt;)&lt;/p&gt;'><sup>1</sup></a>. Instead of requiring custom functions for filtering and selecting data from the central GBIF server (as in <code>rgbif</code>), <code>gbifdb</code> users can take advantage of the full array of <code>dplyr</code> and <code>tidyr</code> functions which can be automatically translated to SQL by <code>dbplyr</code>. Users already familiar with SQL can construct SQL queries directly with <code>DBI</code> instead. <code>gbifdb</code> sends these queries to <a href="https://duckdb.org" class="external-link"><code>duckdb</code></a>, a high-performance, columnar-oriented database engine which runs entirely inside the client, (unlike server-client databases such as MySQL or Postgres, no additional setup is needed outside of installing <code>gbifdb</code>.) <code>duckdb</code> is able to execute these SQL queries directly on-disk against the Parquet data files, side-stepping limitations of available RAM or the need to import the data. It’s highly optimized implementation can be faster even than in-memory operations in <code>dplyr</code>. <code>duckdb</code> supports the full set of SQL instructions, including windowed operations like <code>group_by</code>+<code>summarise</code> as well as table joins.</p>
<p><code>gbifdb</code> has two mechanisms for providing database connections: one which the Parquet snapshot of GBIF must first be downloaded locally, and a second where the GBIF parquet snapshot can be accessed directly from an Amazon Public Data Registry S3 bucket without downloading a copy. The latter approach will be faster for one-off operations and is also suitable when using a cloud-based computing provider in the same region.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<!--

You can install the released version of `gbifdb` from [CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("gbifdb")
```

--><p>And the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ropensci/gbifdb"</span><span class="op">)</span></span></code></pre></div>
<p><code>gbifdb</code> has few dependencies: <code>arrow</code>, <code>duckdb</code> and <code>DBI</code> are required.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/gbifdb/">gbifdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>  <span class="co"># optional, for dplyr-based operations</span></span></code></pre></div>
<div class="section level3">
<h3 id="remote-data-access">Remote data access<a class="anchor" aria-label="anchor" href="#remote-data-access"></a>
</h3>
<p>To begin working with GBIF data directly without downloading the data first, simply establish a remote connection using <code><a href="reference/gbif_remote.html">gbif_remote()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gbif</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gbif_remote.html">gbif_remote</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can now perform most <code>dplyr</code> operations:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gbif</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">phylum</span> <span class="op">==</span> <span class="st">"Chordata"</span>, <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1990</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 461 × 3</span></span>
<span><span class="co">#&gt;    class           year       n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;          &lt;int&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 Actinopterygii  2003  696289</span></span>
<span><span class="co">#&gt;  2 Actinopterygii  2009 1152201</span></span>
<span><span class="co">#&gt;  3 Elasmobranchii  2009   67477</span></span>
<span><span class="co">#&gt;  4 Actinopterygii  2010 1348109</span></span>
<span><span class="co">#&gt;  5 Elasmobranchii  2003   22638</span></span>
<span><span class="co">#&gt;  6 Ascidiacea      2013    9151</span></span>
<span><span class="co">#&gt;  7 Actinopterygii  2002  777535</span></span>
<span><span class="co">#&gt;  8 Actinopterygii  2008 1311066</span></span>
<span><span class="co">#&gt;  9 Elasmobranchii  2008   64769</span></span>
<span><span class="co">#&gt; 10 Elasmobranchii  2002   21948</span></span>
<span><span class="co">#&gt; # … with 451 more rows</span></span></code></pre></div>
<p>By default, this relies on an <code>arrow</code> connection, which currently lacks support for some more complex windowed operations in <code>dplyr</code>. A user can specify the option <code>to_duckdb = TRUE</code> in <code><a href="reference/gbif_remote.html">gbif_remote()</a></code> (or simply pass the connection to <code><a href="https://arrow.apache.org/docs/r/reference/to_duckdb.html" class="external-link">arrow::to_duckdb()</a></code>) to create a <code>duckdb</code> connection. This is slightly slower at this time. Keep in mind that as with any database connection, to use non-<code>dplyr</code> functions the user will generally need to call <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">dplyr::collect()</a></code>, which pulls the data into working memory.<br>
Be sure to subset the data appropriately first (e.g. with <code>filter</code>, <code>summarise</code>, etc), as attempting to <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> a large table will probably exceed available RAM and crash your R session!</p>
<p>When using a <code><a href="reference/gbif_remote.html">gbif_remote()</a></code> connection, all I/O operations will be conducted over the network storage instead of your local disk, without downloading the full dataset first. Consequently, this mechanism will perform best on platforms with faster network connections. These operations will be considerably slower than they would be if you download the entire dataset first (see below, unless you are on an AWS cloud instance in the same region as the remote host), but this does avoid the download step all-together, which may be necessary if you do not have 100+ GB free storage space or the time to download the whole dataset first (e.g. for one-off queries).</p>
</div>
<div class="section level3">
<h3 id="local-data">Local data<a class="anchor" aria-label="anchor" href="#local-data"></a>
</h3>
<p>For extended analysis of GBIF, users may prefer to download the entire GBIF parquet data first. This requires over 100 GB free disk space, and will be a time-consuming process the first time. However, once downloaded, future queries will run much much faster, particularly if you are network-limited. Users can download the current release of GBIF to local storage like so:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/gbif_download.html">gbif_download</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>By default, this will download to the dir given by <code><a href="reference/gbif_dir.html">gbif_dir()</a></code>.<br>
An alternative directory can be provided by setting the environmental variable, <code>GBIF_HOME</code>, or providing the path to the directory containing the parquet files directly.</p>
<p>Once you have downloaded the parquet-formatted GBIF data, <code><a href="reference/gbif_local.html">gbif_local()</a></code> will establish a connection to these local parquet files.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gbif</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gbif_local.html">gbif_local</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gbif</span></span>
<span><span class="co">#&gt; # Source:   lazy query [?? x 48]</span></span>
<span><span class="co">#&gt; # Database: duckdb_connection</span></span>
<span><span class="co">#&gt;        gbifid datasetkey    occurrenceid kingdom phylum class order family genus</span></span>
<span><span class="co">#&gt;         &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1572326202 0e2c20a3-3c3… 7B3E9B63FF9… Animal… Arthr… &lt;NA&gt;  Aran… Capon… Medi…</span></span>
<span><span class="co">#&gt;  2 1572326211 0e2c20a3-3c3… 7B3E9B63FF8… Animal… Arthr… &lt;NA&gt;  Aran… Capon… Medi…</span></span>
<span><span class="co">#&gt;  3 1572326213 0e2c20a3-3c3… 7B3E9B63FF9… Animal… Arthr… &lt;NA&gt;  Aran… Capon… Medi…</span></span>
<span><span class="co">#&gt;  4 1572326222 0e2c20a3-3c3… 7B3E9B63FF8… Animal… Arthr… &lt;NA&gt;  Aran… Capon… Medi…</span></span>
<span><span class="co">#&gt;  5 1572326224 0e2c20a3-3c3… 7B3E9B63FF8… Animal… Arthr… &lt;NA&gt;  Aran… Capon… Medi…</span></span>
<span><span class="co">#&gt;  6 1572326210 0e2c20a3-3c3… 7B3E9B63FF9… Animal… Arthr… &lt;NA&gt;  Aran… Capon… Medi…</span></span>
<span><span class="co">#&gt;  7 1572326209 0e2c20a3-3c3… 7B3E9B63FF8… Animal… Arthr… &lt;NA&gt;  Aran… Capon… Medi…</span></span>
<span><span class="co">#&gt;  8 1572326215 0e2c20a3-3c3… 7B3E9B63FF8… Animal… Arthr… &lt;NA&gt;  Aran… Capon… Medi…</span></span>
<span><span class="co">#&gt;  9 1572326228 0e2c20a3-3c3… 7B3E9B63FF8… Animal… Arthr… &lt;NA&gt;  Aran… Capon… Medi…</span></span>
<span><span class="co">#&gt; 10 1572326205 0e2c20a3-3c3… 7B3E9B63FF8… Animal… Arthr… &lt;NA&gt;  Aran… Capon… Medi…</span></span>
<span><span class="co">#&gt; # … with more rows, and 39 more variables: species &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   infraspecificepithet &lt;chr&gt;, taxonrank &lt;chr&gt;, scientificname &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   verbatimscientificname &lt;chr&gt;, verbatimscientificnameauthorship &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   countrycode &lt;chr&gt;, locality &lt;chr&gt;, stateprovince &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   occurrencestatus &lt;chr&gt;, individualcount &lt;int&gt;, publishingorgkey &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   decimallatitude &lt;dbl&gt;, decimallongitude &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   coordinateuncertaintyinmeters &lt;dbl&gt;, coordinateprecision &lt;dbl&gt;, …</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">gbif</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "gbifid"                           "datasetkey"                      </span></span>
<span><span class="co">#&gt;  [3] "occurrenceid"                     "kingdom"                         </span></span>
<span><span class="co">#&gt;  [5] "phylum"                           "class"                           </span></span>
<span><span class="co">#&gt;  [7] "order"                            "family"                          </span></span>
<span><span class="co">#&gt;  [9] "genus"                            "species"                         </span></span>
<span><span class="co">#&gt; [11] "infraspecificepithet"             "taxonrank"                       </span></span>
<span><span class="co">#&gt; [13] "scientificname"                   "verbatimscientificname"          </span></span>
<span><span class="co">#&gt; [15] "verbatimscientificnameauthorship" "countrycode"                     </span></span>
<span><span class="co">#&gt; [17] "locality"                         "stateprovince"                   </span></span>
<span><span class="co">#&gt; [19] "occurrencestatus"                 "individualcount"                 </span></span>
<span><span class="co">#&gt; [21] "publishingorgkey"                 "decimallatitude"                 </span></span>
<span><span class="co">#&gt; [23] "decimallongitude"                 "coordinateuncertaintyinmeters"   </span></span>
<span><span class="co">#&gt; [25] "coordinateprecision"              "elevation"                       </span></span>
<span><span class="co">#&gt; [27] "elevationaccuracy"                "depth"                           </span></span>
<span><span class="co">#&gt; [29] "depthaccuracy"                    "eventdate"                       </span></span>
<span><span class="co">#&gt; [31] "day"                              "month"                           </span></span>
<span><span class="co">#&gt; [33] "year"                             "taxonkey"                        </span></span>
<span><span class="co">#&gt; [35] "specieskey"                       "basisofrecord"                   </span></span>
<span><span class="co">#&gt; [37] "institutioncode"                  "collectioncode"                  </span></span>
<span><span class="co">#&gt; [39] "catalognumber"                    "recordnumber"                    </span></span>
<span><span class="co">#&gt; [41] "identifiedby"                     "dateidentified"                  </span></span>
<span><span class="co">#&gt; [43] "license"                          "rightsholder"                    </span></span>
<span><span class="co">#&gt; [45] "recordedby"                       "typestatus"                      </span></span>
<span><span class="co">#&gt; [47] "establishmentmeans"               "lastinterpreted"</span></span></code></pre></div>
<p>Now, we can use <code>dplyr</code> to perform standard queries:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">growth</span> <span class="op">&lt;-</span> <span class="va">gbif</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">phylum</span> <span class="op">==</span> <span class="st">"Chordata"</span>, <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1990</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">growth</span></span>
<span><span class="co">#&gt; # Source:     lazy query [?? x 3]</span></span>
<span><span class="co">#&gt; # Database:   duckdb_connection</span></span>
<span><span class="co">#&gt; # Groups:     class</span></span>
<span><span class="co">#&gt; # Ordered by: year</span></span>
<span><span class="co">#&gt;    class               year      n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;              &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Cephalaspidomorphi  1991   1152</span></span>
<span><span class="co">#&gt;  2 Elasmobranchii      1991  17521</span></span>
<span><span class="co">#&gt;  3 Ascidiacea          1991   1602</span></span>
<span><span class="co">#&gt;  4 Thaliacea           1991    669</span></span>
<span><span class="co">#&gt;  5 Amphibia            1991  18443</span></span>
<span><span class="co">#&gt;  6 Sarcopterygii       1991     13</span></span>
<span><span class="co">#&gt;  7 Leptocardii         1991     36</span></span>
<span><span class="co">#&gt;  8 &lt;NA&gt;                1991    912</span></span>
<span><span class="co">#&gt;  9 Actinopterygii      1991 363791</span></span>
<span><span class="co">#&gt; 10 Holocephali         1991   1048</span></span>
<span><span class="co">#&gt; # … with more rows</span></span></code></pre></div>
<p>Recall that when database connections in <code>dplyr</code>, the data remains in the database (i.e. on disk, not in working RAM).<br>
This is fine for any further operations using <code>dplyr</code>/<code>tidyr</code> functions which can be translated into SQL.<br>
Using such functions we can usually reduce our resulting table to something much smaller, which can then be pulled into memory in R for further analysis using <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="co"># GBIF: the global bird information facility?</span></span>
<span><span class="va">growth</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>class <span class="op">=</span> <span class="fu">fct_lump_n</span><span class="op">(</span><span class="va">class</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">n</span>, fill<span class="op">=</span><span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"GBIF observations of vertebrates by class"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="visualizing-all-of-gbif">Visualizing all of GBIF<a class="anchor" aria-label="anchor" href="#visualizing-all-of-gbif"></a>
</h2>
<p>Database operations such as rounding provide an easy way to “rasterize” the data for spatial visualizations. Here we quickly generate where color intensity reflects the logarithmic occurrence count in that pixel:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/" class="external-link">viridisLite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gbif_local.html">gbif_local</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">db</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">decimallatitude</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                   longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">decimallongitude</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="va">df</span>, crs<span class="op">=</span><span class="st">"epsg:4326"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span>, col<span class="op">=</span> <span class="fu">viridis</span><span class="op">(</span><span class="fl">1e3</span><span class="op">)</span>, legend<span class="op">=</span><span class="cn">FALSE</span>, maxcell<span class="op">=</span><span class="fl">6e6</span>, colNA<span class="op">=</span><span class="st">"black"</span>, axes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="performance-notes">Performance notes<a class="anchor" aria-label="anchor" href="#performance-notes"></a>
</h2>
<p>Because <code>parquet</code> is a columnar-oriented dataset, performance can be improved by including a <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> call at the end of a dplyr function chain to only return the columns you actually need. This can be particularly helpful on remote connections using <code><a href="reference/gbif_remote.html">gbif_remote()</a></code>.</p>
</div>
</div>


  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=gbifdb" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/ropensci/gbifdb/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ropensci/gbifdb" class="external-link">Report a bug</a></li>
</ul>
</div>



<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing gbifdb</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Carl Boettiger <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-1642-628X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="r-universe">
<h2 data-toc-skip>R-universe</h2>
<ul class="list-unstyled">
<li><p><a href="https://ropensci.r-universe.dev/gbifdb" class="external-link"><img src="https://ropensci.r-universe.dev/badges/gbifdb" alt="gbifdb status badge"></a></p></li>
</ul>
</div>

<div class="software-peer-review">
<h2 data-toc-skip>Software Peer-Review</h2>
<ul class="list-unstyled">
<li><p><a href="https://github.com/ropensci/software-review/issues/492" class="external-link"><img src="https://badges.ropensci.org/492_status.svg" alt="rOpenSci peer-review"></a></p></li>
</ul>
</div>

  </aside>
</div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
